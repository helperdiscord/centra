var yt=Object.create,we=Object.defineProperty,bt=Object.getPrototypeOf,wt=Object.prototype.hasOwnProperty,Tt=Object.getOwnPropertyNames,Et=Object.getOwnPropertyDescriptor;var Te=Object.assign,kt=t=>we(t,"__esModule",{value:!0});var $=(t,e)=>()=>(e||(e={exports:{}},t(e.exports,e)),e.exports);var St=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Tt(e))!wt.call(t,s)&&s!=="default"&&we(t,s,{get:()=>e[s],enumerable:!(r=Et(e,s))||r.enumerable});return t},J=t=>St(kt(we(t!=null?yt(bt(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Pe=$((er,Ne)=>{"use strict";var{HTTPParser:Rt}=process.binding("http_parser");Ne.exports=Rt});var Ee=$((tr,Ae)=>{Ae.exports={kUrl:Symbol("url"),kWriting:Symbol("writing"),kResuming:Symbol("resuming"),kQueue:Symbol("queue"),kConnect:Symbol("connect"),kIdleTimeout:Symbol("idle timeout"),kIdleTimeoutValue:Symbol("idle timeout value"),kKeepAliveDefaultTimeout:Symbol("default keep alive timeout"),kKeepAliveMaxTimeout:Symbol("max keep alive timeout"),kKeepAliveTimeoutThreshold:Symbol("keep alive timeout threshold"),kKeepAliveTimeoutValue:Symbol("keep alive timeout"),kKeepAlive:Symbol("keep alive"),kHeadersTimeout:Symbol("headers timeout"),kBodyTimeout:Symbol("body timeout"),kTLSServerName:Symbol("server name"),kHost:Symbol("host"),kTLSOpts:Symbol("TLS Options"),kClosed:Symbol("closed"),kNeedDrain:Symbol("need drain"),kReset:Symbol("reset"),kDestroyed:Symbol("destroyed"),kMaxHeadersSize:Symbol("max headers size"),kRunningIdx:Symbol("running index"),kPendingIdx:Symbol("pending index"),kError:Symbol("error"),kClient:Symbol("client"),kParser:Symbol("parser"),kOnDestroyed:Symbol("destroy callbacks"),kPipelining:Symbol("pipelinig"),kSocketPath:Symbol("socket path"),kSocket:Symbol("socket"),kTLSSession:Symbol("tls session cache"),kHostHeader:Symbol("host header"),kAgentOpts:Symbol("agent opts"),kAgentCache:Symbol("agent cache")}});var he=$((rr,De)=>{"use strict";var S=class extends Error{constructor(e){super(e);this.name="UndiciError",this.code="UND_ERR"}},X=class extends S{constructor(e){super(e);Error.captureStackTrace(this,X),this.name="HeadersTimeoutError",this.message=e||"Headers Timeout Error",this.code="UND_ERR_HEADERS_TIMEOUT"}},Y=class extends S{constructor(e){super(e);Error.captureStackTrace(this,Y),this.name="BodyTimeoutError",this.message=e||"Body Timeout Error",this.code="UND_ERR_BODY_TIMEOUT"}},Z=class extends S{constructor(e){super(e);Error.captureStackTrace(this,Z),this.name="InvalidArgumentError",this.message=e||"Invalid Argument Error",this.code="UND_ERR_INVALID_ARG"}},ee=class extends S{constructor(e){super(e);Error.captureStackTrace(this,ee),this.name="InvalidReturnValueError",this.message=e||"Invalid Return Value Error",this.code="UND_ERR_INVALID_RETURN_VALUE"}},te=class extends S{constructor(e){super(e);Error.captureStackTrace(this,te),this.name="RequestAbortedError",this.message=e||"Request aborted",this.code="UND_ERR_ABORTED"}},re=class extends S{constructor(e){super(e);Error.captureStackTrace(this,re),this.name="InformationalError",this.message=e||"Request information",this.code="UND_ERR_INFO"}},se=class extends S{constructor(e){super(e);Error.captureStackTrace(this,se),this.name="ContentLengthMismatchError",this.message=e||"Request body length does not match content-length header",this.code="UND_ERR_CONTENT_LENGTH_MISMATCH"}},ne=class extends S{constructor(e){super(e);Error.captureStackTrace(this,ne),this.name="TrailerMismatchError",this.message=e||"Trailers does not match trailer header",this.code="UND_ERR_TRAILER_MISMATCH"}},ie=class extends S{constructor(e){super(e);Error.captureStackTrace(this,ie),this.name="ClientDestroyedError",this.message=e||"The client is destroyed",this.code="UND_ERR_DESTROYED"}},oe=class extends S{constructor(e){super(e);Error.captureStackTrace(this,oe),this.name="ClientClosedError",this.message=e||"The client is closed",this.code="UND_ERR_CLOSED"}},ue=class extends S{constructor(e){super(e);Error.captureStackTrace(this,ue),this.name="SocketError",this.message=e||"Socket error",this.code="UND_ERR_SOCKET"}},ae=class extends S{constructor(e){super(e);Error.captureStackTrace(this,ae),this.name="NotSupportedError",this.message=e||"Not supported error",this.code="UND_ERR_NOT_SUPPORTED"}};De.exports={UndiciError:S,HeadersTimeoutError:X,BodyTimeoutError:Y,ContentLengthMismatchError:se,TrailerMismatchError:ne,InvalidArgumentError:Z,InvalidReturnValueError:ee,RequestAbortedError:te,ClientDestroyedError:ie,ClientClosedError:oe,InformationalError:re,SocketError:ue,NotSupportedError:ae}});var ke=$((sr,He)=>{"use strict";var Ue=require("assert"),{kDestroyed:qe}=Ee(),{IncomingMessage:Ct}=require("http"),vt=require("util"),Lt=require("net"),{InvalidArgumentError:K}=he();function Ot(){}function Ie(t){return!!(t&&typeof t.on=="function")}function Be(t){if(typeof t=="string"&&(t=new URL(t)),!t||typeof t!="object")throw new K("invalid url");if(t.port!=null&&t.port!==""&&!Number.isFinite(parseInt(t.port)))throw new K("invalid port");if(t.hostname!=null&&typeof t.hostname!="string")throw new K("invalid hostname");if(!/https?/.test(t.protocol))throw new K("invalid protocol");if(!(t instanceof URL)){let e=t.port||{"http:":80,"https:":443}[t.protocol];Ue(e!=null);let r=t.path||`${t.pathname||"/"}${t.search||""}`;t=new URL(`${t.protocol}//${t.hostname}:${e}${r}`)}return t}function xt(t){if(t=Be(t),/\/.+/.test(t.pathname)||t.search||t.hash)throw new K("invalid url");return t}function _t(t){if(!t)return null;let e=t;if(e.startsWith("[")){let r=e.indexOf("]");e=r===-1?e:e.substr(1,r-1)}else e=e.split(":",1)[0];return Lt.isIP(e)&&(e=null),e}function Nt(t){if(t&&typeof t.on=="function"){let e=t._readableState;return e&&e.ended===!0&&Number.isFinite(e.length)?e.length:null}return Ue(!t||Number.isFinite(t.byteLength)),t?t.length:0}function $e(t){return!t||!!(t.destroyed||t[qe])}function Pt(t,e){!Ie(t)||$e(t)||(typeof t.destroy=="function"?(e||Object.getPrototypeOf(t).constructor!==Ct)&&t.destroy(e):e&&process.nextTick((r,s)=>{r.emit("error",s)},t,e),t.destroyed!==!0&&(t[qe]=!0))}var At=/timeout=(\d+)/;function Dt(t){let e=t.match(At);return e?parseInt(e[1])*1e3:null}function Ht(t,e={}){for(let r=0;r<t.length;r+=2){let s=t[r].toLowerCase(),n=e[s];n?(Array.isArray(n)||(n=[n],e[s]=n),n.push(t[r+1])):e[s]=t[r+1]}return e}function Ut(t){return t instanceof Uint8Array||Buffer.isBuffer(t)}function qt(t,e){let r=vt.getSystemErrorName(t),s=new Error(`${e} ${r}`);return s.errno=s,s.code=t,s.syscall=e,s}He.exports={nop:Ot,parseOrigin:xt,parseURL:Be,getServerName:_t,errnoException:qt,isStream:Ie,isDestroyed:$e,parseHeaders:Ht,parseKeepAliveTimeout:Dt,destroy:Pt,bodyLength:Nt,isBuffer:Ut,queueMicrotask:global.queueMicrotask||(t=>Promise.resolve().then(t).catch(e=>setTimeout(()=>{throw e},0)))}});var Ke=$((nr,Me)=>{"use strict";var{InvalidArgumentError:g,NotSupportedError:It}=he(),Se=ke(),P=require("assert"),D=Symbol("handler"),Bt=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\x00a1-\xffff0-9]+-?)*[a-z\x00a1-\xffff0-9]+)(?:\.(?:[a-z\x00a1-\xffff0-9]+-?)*[a-z\x00a1-\xffff0-9]+)*(?:\.(?:[a-z\x00a1-\xffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/ius,je=class{constructor({path:e,method:r,body:s,headers:n,idempotent:h,upgrade:o},d){if(typeof e!="string")throw new g("path must be a string");if(e[0]!=="/"&&!Bt.test(e))throw new g("path must be an absolute URL or start with a slash");if(typeof r!="string")throw new g("method must be a string");if(o&&typeof o!="string")throw new g("upgrade must be a string");if(this.method=r,s==null)this.body=null;else if(Se.isStream(s))this.body=s;else if(Se.isBuffer(s))this.body=s.length?s:null;else if(typeof s=="string")this.body=s.length?Buffer.from(s):null;else throw new g("body must be a string, a Buffer or a Readable stream");if(this.aborted=!1,this.upgrade=o||r==="CONNECT"||null,this.path=e,this.idempotent=h==null?r==="HEAD"||r==="GET":h,this.host=null,this.contentLength=null,this.headers="",Array.isArray(n)){if(n.length%2!=0)throw new g("headers array must be even");for(let l=0;l<n.length;l+=2)ze(this,n[l+0],n[l+1])}else if(n&&typeof n=="object")for(let[l,u]of Object.entries(n))ze(this,l,u);else if(n!=null)throw new g("headers must be an object or an array");if(typeof d.onConnect!="function")throw new g("invalid onConnect method");if(typeof d.onError!="function")throw new g("invalid onError method");if(this.upgrade){if(typeof d.onUpgrade!="function")throw new g("invalid onUpgrade method")}else{if(typeof d.onHeaders!="function")throw new g("invalid onHeaders method");if(typeof d.onData!="function")throw new g("invalid onData method");if(typeof d.onComplete!="function")throw new g("invalid onComplete method")}this[D]=d}onConnect(e){return P(!this.aborted),this[D].onConnect(e)}onHeaders(e,r,s){return P(!this.aborted),this[D].onHeaders(e,r,s)}onData(e){return P(!this.aborted),P(!this.upgrade),this[D].onData(e)}onUpgrade(e,r,s){return P(!this.aborted),P(this.upgrade),this[D].onUpgrade(e,r,s)}onComplete(e){return P(!this.aborted),P(!this.upgrade),this[D].onComplete(e)}onError(e){this.aborted||(this.aborted=!0,Se.queueMicrotask(()=>this[D].onError(e)))}};function ze(t,e,r){if(r&&typeof r=="object")throw new g(`invalid ${e} header`);if(r===void 0)return;if(t.host===null&&e.length===4&&e.toLowerCase()==="host")t.host=r,t.headers+=`${e}: ${r}\r
`;else if(t.contentLength===null&&e.length===14&&e.toLowerCase()==="content-length"){if(t.contentLength=parseInt(r),!Number.isFinite(t.contentLength))throw new g("invalid content-length header")}else{if(e.length===17&&e.toLowerCase()==="transfer-encoding")throw new g("invalid transfer-encoding header");if(e.length===10&&e.toLowerCase()==="connection")throw new g("invalid connection header");if(e.length===10&&e.toLowerCase()==="keep-alive")throw new g("invalid keep-alive header");if(e.length===7&&e.toLowerCase()==="upgrade")throw new g("invalid upgrade header");if(e.length===6&&e.toLowerCase()==="expect")throw new It("expect header not supported");t.headers+=`${e}: ${r}\r
`}}Me.exports=je});var ct=$((ir,Fe)=>{"use strict";var Ve=require("net"),Ge=require("tls"),T=Pe(),$t=require("events"),f=require("assert"),a=ke(),Mt=Ke(),{ContentLengthMismatchError:Re,TrailerMismatchError:Qe,InvalidArgumentError:E,RequestAbortedError:We,HeadersTimeoutError:jt,ClientDestroyedError:Ce,ClientClosedError:zt,SocketError:le,InformationalError:M,BodyTimeoutError:Kt}=he(),{kUrl:N,kReset:O,kHost:de,kClient:j,kParser:ce,kConnect:Ft,kResuming:H,kWriting:U,kQueue:y,kNeedDrain:F,kTLSServerName:fe,kKeepAliveDefaultTimeout:ve,kHostHeader:Je,kTLSOpts:pe,kClosed:z,kDestroyed:A,kPendingIdx:R,kRunningIdx:b,kError:me,kOnDestroyed:q,kPipelining:I,kSocket:m,kSocketPath:V,kKeepAliveTimeoutValue:ge,kMaxHeadersSize:Le,kKeepAliveMaxTimeout:Xe,kKeepAliveTimeoutThreshold:Ye,kTLSSession:G,kIdleTimeout:Q,kIdleTimeoutValue:ye,kHeadersTimeout:W,kBodyTimeout:Oe}=Ee(),Ze=process.version.split("."),be=parseInt(Ze[0].slice(1)),et=parseInt(Ze[1]),Vt=process.execArgv.includes("--insecure-http-parser");function tt(t,e){return a.getServerName(e)||t[pe]&&t[pe].servername||a.getServerName(t[N].host||t[N].hostname)||null}var rt=class extends $t{constructor(e,{maxHeaderSize:r,headersTimeout:s,socketTimeout:n,requestTimeout:h,bodyTimeout:o,idleTimeout:d,keepAlive:l,keepAliveTimeout:u,maxKeepAliveTimeout:i,keepAliveMaxTimeout:c,keepAliveTimeoutThreshold:p,socketPath:k,pipelining:L,tls:_}={}){super();if(l!==void 0)throw new E("unsupported keepAlive, use pipelining=0 instead");if(n!==void 0)throw new E("unsupported socketTimeout, use headersTimeout & bodyTimeout instead");if(h!==void 0)throw new E("unsupported requestTimeout, use headersTimeout & bodyTimeout instead");if(d!==void 0)throw new E("unsupported idleTimeout, use keepAliveTimeout instead");if(i!==void 0)throw new E("unsupported maxKeepAliveTimeout, use keepAliveMaxTimeout instead");if(r!=null&&!Number.isFinite(r))throw new E("invalid maxHeaderSize");if(k!=null&&typeof k!="string")throw new E("invalid socketPath");if(u!=null&&(!Number.isFinite(u)||u<=0))throw new E("invalid keepAliveTimeout");if(c!=null&&(!Number.isFinite(c)||c<=0))throw new E("invalid keepAliveMaxTimeout");if(p!=null&&!Number.isFinite(p))throw new E("invalid keepAliveTimeoutThreshold");if(s!=null&&(!Number.isInteger(s)||s<0))throw new E("headersTimeout must be a positive integer or zero");if(o!=null&&(!Number.isInteger(o)||o<0))throw new E("bodyTimeout must be a positive integer or zero");this[m]=null,this[I]=L!=null?L:1,this[Le]=r||16384,this[N]=a.parseOrigin(e),this[V]=k,this[ve]=u==null?4e3:u,this[Xe]=c==null?6e5:c,this[Ye]=p==null?1e3:p,this[ge]=this[ve],this[z]=!1,this[A]=!1,this[pe]=_,this[fe]=tt(this),this[de]=null,this[q]=[],this[H]=0,this[F]=0,this[G]=null,this[Je]=`host: ${this[N].hostname}${this[N].port?`:${this[N].port}`:""}\r
`,this[Oe]=o!=null?o:3e4,this[W]=s!=null?s:3e4,this[y]=[],this[b]=0,this[R]=0}get url(){return this[N]}get pipelining(){return this[I]}set pipelining(e){this[I]=e,x(this,!0)}get connected(){return this[m]&&this[m].connecting!==!0&&(this[m].authorized!==!1||this[m].authorizationError)&&!this[m].destroyed}get pending(){return this[y].length-this[R]}get running(){return this[R]-this[b]}get size(){return this[y].length-this[b]}get busy(){let e=this[m];return e&&(e[O]||e[U])||this.size>=(this[I]||1)||this.pending>0}get destroyed(){return this[A]}get closed(){return this[z]}[Ft](e){st(this),this.once("connect",e)}dispatch(e,r){try{let s=new Mt(e,r);if(this[A])throw new Ce;if(this[z])throw new zt;this[y].push(s),this[H]||(a.isStream(s.body)?(this[H]=1,process.nextTick(x,this)):x(this,!0))}catch(s){if(typeof r.onError!="function")throw new E("invalid onError method");r.onError(s)}}close(e){if(e===void 0)return new Promise((r,s)=>{this.close((n,h)=>n?s(n):r(h))});if(typeof e!="function")throw new E("invalid callback");if(this[A]){process.nextTick(e,new Ce,null);return}this[z]=!0,this.size?this[q].push(e):this.destroy(e)}destroy(e,r){if(typeof e=="function"&&(r=e,e=null),r===void 0)return new Promise((n,h)=>{this.destroy(e,(o,d)=>o?h(o):n(d))});if(typeof r!="function")throw new E("invalid callback");if(this[A]){this[q]?this[q].push(r):process.nextTick(r,null,null);return}e||(e=new Ce);for(let n of this[y].splice(this[R]))n.onError(e);this[z]=!0,this[A]=!0,this[q].push(r);let s=()=>{let n=this[q];this[q]=null;for(let h of n)h(null,null)};this[m]?a.destroy(this[m].on("close",s),e):process.nextTick(s),x(this)}},nt=class extends T{constructor(e,r){if(be===12&&et<19){super();this.initialize(T.RESPONSE,{},0)}else if(be===12&&et>=19){super();this.initialize(T.RESPONSE,{},e[Le],0)}else if(be>12){super();this.initialize(T.RESPONSE,{},e[Le],Vt,0)}else super(T.RESPONSE,!1);this.client=e,this.socket=r,this.timeout=null,this.statusCode=null,this.upgrade=!1,this.headers=null,this.shouldKeepAlive=!1,this.request=null,this.paused=!1,this.resuming=!1,this.queue=[],this._resume=()=>{if(!(!this.paused||this.resuming)){for(this.paused=!1,this.resuming=!0;this.queue.length;){let[s,...n]=this.queue.shift();if(Reflect.apply(s,this,n),this.paused){this.resuming=!1;return}}this.resuming=!1,Wt(this.socket)}},this._pause=()=>{this.paused||(this.paused=!0,Qt(this.socket))}}[T.kOnHeaders](e){if(this.paused){this.queue.push([this[T.kOnHeaders],e]);return}this.headers?Array.prototype.push.apply(this.headers,e):this.headers=e}[T.kOnExecute](e){if(this.paused){this.queue.push([this[T.kOnExecute],e]);return}let{upgrade:r,socket:s}=this;if(!Number.isFinite(e)){f(e instanceof Error),a.destroy(s,e);return}if(r&&!s.destroyed){let{client:n,headers:h,statusCode:o,request:d}=this;f(!s.destroyed),f(s===n[m]),f(!s.isPaused()),f(s._handle&&s._handle.reading),f(d.upgrade),this.headers=null,this.statusCode=null,this.request=null,s._readableState.flowing=null,s.unshift(this.getCurrentBuffer().slice(e));try{d.onUpgrade(o,h,s),!s.destroyed&&!d.aborted&&(ot(s),n[m]=null,n[y][n[b]++]=null,n.emit("disconnect",new M("upgrade"))),x(n)}catch(l){a.destroy(s,l)}}}[T.kOnHeadersComplete](e,r,s,n,h,o,d,l,u){if(this.paused){this.queue.push([this[T.kOnHeadersComplete],e,r,s,n,h,o,d,l,u]);return}let{client:i,socket:c}=this,p=i[y][i[b]];if(c.destroyed)return;if(clearTimeout(this.timeout),this.timeout=i[Oe]?setTimeout(Gt,i[Oe],this):null,f(!this.upgrade),f(this.statusCode<200),o===100)return a.destroy(c,new le("bad response")),1;if(p.upgrade!==!0&&l!==Boolean(p.upgrade))return a.destroy(c,new le("bad upgrade")),1;if(this.headers?Array.prototype.push.apply(this.headers,s):this.headers=s,this.statusCode=o,this.shouldKeepAlive=u,this.request=p,p.upgrade)return this.unconsume(),this.upgrade=!0,2;let k,L,{headers:_}=this;this.headers=null;for(let C=0;C<_.length;C+=2){let w=_[C+0],v=_[C+1];!k&&w.length===10&&w.toLowerCase()==="keep-alive"?k=v:!L&&w.length===7&&w.toLowerCase()==="trailer"&&(L=v)}if(this.trailers=L?L.toLowerCase().split(/,\s*/):null,u&&i[I]){let C=k?a.parseKeepAliveTimeout(k):null;if(C!=null){let w=Math.min(C-i[Ye],i[Xe]);w<=0?c[O]=!0:i[ge]=w}else i[ge]=i[ve]}else c[O]=!0;try{p.onHeaders(o,_,this._resume)===!1&&this._pause()}catch(C){return a.destroy(c,C),1}return p.method==="HEAD"||o<200?1:0}[T.kOnBody](e,r,s){if(this.paused){this.queue.push([this[T.kOnBody],e,r,s]);return}let{socket:n,statusCode:h,request:o,timeout:d}=this;if(!n.destroyed){d&&d.refresh&&d.refresh(),f(h>=200);try{o.onData(e.slice(r,r+s))===!1&&this._pause()}catch(l){a.destroy(n,l)}}}[T.kOnMessageComplete](){if(this.paused){this.queue.push([this[T.kOnMessageComplete]]);return}let{client:e,socket:r,statusCode:s,headers:n,upgrade:h,request:o,trailers:d}=this;if(!r.destroyed){if(f(s>=100),f(this.resuming||r._handle&&r._handle.reading),h){f(s<300||o.method==="CONNECT");return}if(this.statusCode=null,this.headers=null,this.request=null,this.trailers=null,clearTimeout(this.timeout),this.timeout=e[W]?setTimeout(it,e[W],this):null,!(s<200)){try{if(d){if(!n)throw new Qe;for(let l of d){let u=!1;for(let i=0;i<n.length;i+=2){let c=n[i+0];if(c.length===l.length&&c.toLowerCase()===l.toLowerCase()){u=!0;break}}if(!u)throw new Qe}}try{o.onComplete(n)}catch(l){o.onError(l)}}catch(l){a.destroy(r,l);return}e[y][e[b]++]=null,r[U]?a.destroy(r,new M("reset")):this.shouldKeepAlive?r[O]&&!e.running?a.destroy(r,new M("reset")):x(e):a.destroy(r,new M("reset"))}}}destroy(){clearTimeout(this.timeout),this.timeout=null,this.unconsume(),setImmediate(e=>e.close(),this)}};function Gt(t){t.paused||a.destroy(t.socket,new Kt)}function it(t){a.destroy(t.socket,new jt)}function Jt(){let{[j]:t}=this;t.emit("connect"),x(t)}function ut(t){let{[j]:e}=this;if(this[me]=t,t.code==="ERR_TLS_CERT_ALTNAME_INVALID")for(f(!e.running);e.pending&&e[y][e[R]].host===e[de];)e[y][e[R]++].onError(t);else if(!e.running&&t.code!=="UND_ERR_INFO"&&t.code!=="UND_ERR_SOCKET"){f(e[R]===e[b]);for(let r of e[y].splice(e[b]))r.onError(t)}}function at(){a.destroy(this,new le("other side closed"))}function ot(t){clearTimeout(t[Q]),t[Q]=null,t[ye]=null,t[ce].destroy(),t[ce]=null,t[j]=null,t[me]=null,t.removeListener("session",lt).removeListener("error",ut).removeListener("end",at).removeListener("close",ht)}function ht(){let{[j]:t}=this,e=this[me]||new le("closed");if(ot(this),t[m]=null,e.code!=="UND_ERR_INFO"&&(t[G]=null),t[A]){f(!t.pending);for(let r of t[y].splice(t[b]))r.onError(e);t[R]=t[b]}else t.running&&e.code!=="UND_ERR_INFO"&&(t[y][t[b]].onError(e),t[y][t[b]++]=null),t[R]=t[b],t.emit("disconnect",e);x(t)}function lt(t){let{[j]:e}=this;e[G]=t}function st(t){f(!t[m]);let{protocol:e,port:r,hostname:s}=t[N],n;if(e==="https:"){let o=Te(Te({},t[pe]),{servername:t[fe],session:t[G]});n=t[V]?Ge.connect(t[V],o):Ge.connect(r||443,s,o),n.on("session",lt)}else n=t[V]?Ve.connect(t[V]):Ve.connect(r||80,s);t[m]=n;let h=new nt(t,n);be>=12?(f(n._handle),h.consume(n._handle)):(f(n._handle&&n._handle._externalStream),h.consume(n._handle._externalStream)),n[Q]=null,n[ye]=null,n[U]=!1,n[O]=!1,n[me]=null,n[ce]=h,n[j]=t,n.setNoDelay(!0).on(e==="https:"?"secureConnect":"connect",Jt).on("error",ut).on("end",at).on("close",ht)}function Qt(t){if(t._handle&&t._handle.reading){t._handle.reading=!1;let e=t._handle.readStop();e&&t.destroy(a.errnoException(e,"read"))}}function Wt(t){if(t._handle&&!t._handle.reading){t._handle.reading=!0;let e=t._handle.readStart();e&&t.destroy(a.errnoException(e,"read"))}}function dt(t){t[F]=0,t.emit("drain")}function x(t,e){t[H]!==2&&(t[H]=2,Xt(t,e),t[H]=0,t[b]>256&&(t[y].splice(0,t[b]),t[R]-=t[b],t[b]=0))}function Xt(t,e){for(;;){if(t[A]){f(!t.pending);return}if(t[z]&&!t.size){t.destroy(a.nop);continue}if(t[m]){let n=t[m],h=t.running?0:t[ge];n[ye]!==h&&(clearTimeout(n[Q]),h&&(n[Q]=setTimeout(o=>{a.destroy(o,new M("socket idle timeout"))},h,n)),n[ye]=h)}if(t.running){let{aborted:n}=t[y][t[b]];if(n){a.destroy(t[m]);return}}if(t.busy)t[F]=2;else if(t[F]===2){e?(t[F]=1,process.nextTick(dt,t)):dt(t);continue}if(!t.pending||t.running>=(t[I]||1))return;let r=t[m],s=t[y][t[R]];if(t[N].protocol==="https:"&&t[de]!==s.host){if(t.running)return;t[de]=s.host;let n=tt(t,s.host);if(t[fe]!==n&&(t[fe]=n,t[G]=null,r)){a.destroy(r,new M("servername changed"));return}}if(!r){st(t);return}if(!t.connected||r[U]||r[O]||t.running&&!s.idempotent||t.running&&s.upgrade||(a.isStream(s.body)&&a.bodyLength(s.body)===0&&(s.body.on("data",function(){f(!1)}).on("error",function(n){s.onError(n)}).on("end",function(){a.destroy(this)}),s.body=null),t.running&&a.isStream(s.body)))return;if(!s.aborted&&Yt(t,s)){let n=t[m][ce];!n.timeout&&t[W]&&(n.timeout=setTimeout(it,t[W],n)),t[R]++}else t[y].splice(t[R],1)}}function Yt(t,e){let{body:r,method:s,path:n,host:h,upgrade:o,headers:d}=e,l=s==="PUT"||s==="POST"||s==="PATCH";r&&typeof r.read=="function"&&r.read(0);let u=a.bodyLength(r);if(u===null&&(u=e.contentLength),u===0&&!l&&(u=null),e.contentLength!==null&&e.contentLength!==u)return e.onError(new Re),!1;if(e.aborted)return!1;try{e.onConnect(p=>{e.aborted||(e.onError(p||new We),t[H]===0&&x(t,!0))})}catch(p){e.onError(p)}if(e.aborted)return!1;let i=t[m];s==="HEAD"&&(i[O]=!0),o&&(i[O]=!0);let c;if(typeof o=="string"?c=`${s} ${n} HTTP/1.1\r
connection: upgrade\r
upgrade: ${o}\r
`:t[I]?c=`${s} ${n} HTTP/1.1\r
connection: keep-alive\r
`:c=`${s} ${n} HTTP/1.1\r
connection: close\r
`,h||(c+=t[Je]),d&&(c+=d),!r)u===0?i.write(`${c}content-length: ${u}\r
\r
\r
`,"ascii"):(f(u===null,"no body must not have content length"),i.write(`${c}\r
`,"ascii"));else if(a.isBuffer(r))f(u!==null,"buffer body must have content length"),i.cork(),i.write(`${c}content-length: ${u}\r
\r
`,"ascii"),i.write(r),i.write(`\r
`,"ascii"),i.uncork(),l||(i[O]=!0);else{i[U]=!0,f(a.isStream(r)),f(u!==0||!t.running,"stream body cannot be pipelined");let p=!1,k=0,L=function(v){try{f(!p);let B=Buffer.byteLength(v);if(!B)return;if(u!==null&&k+B>u){a.destroy(i,new Re);return}k===0&&(l||(i[O]=!0),u===null?i.write(`${c}transfer-encoding: chunked\r
`,"ascii"):i.write(`${c}content-length: ${u}\r
\r
`,"ascii")),u===null&&i.write(`\r
${B.toString(16)}\r
`,"ascii"),k+=B,!i.write(v)&&this.pause&&this.pause()}catch(B){a.destroy(this,B)}},_=function(){f(!p),r.resume&&r.resume()},C=function(){w(new We)},w=function(v){p||(p=!0,f(i.destroyed||i[U]&&t.running<=1),i[U]=!1,!v&&u!==null&&k!==u&&(v=new Re),i.removeListener("drain",_).removeListener("error",w),r.removeListener("data",L).removeListener("end",w).removeListener("error",w).removeListener("close",C),a.destroy(r,v),v&&(f(t.running<=1,"pipeline should only contain this request"),a.destroy(i,v)),!i.destroyed&&(k===0?l?i.write(`${c}content-length: 0\r
\r
\r
`,"ascii"):i.write(`${c}\r
`,"ascii"):u===null&&i.write(`\r
0\r
\r
`,"ascii"),x(t)))};r.on("data",L).on("end",w).on("error",w).on("close",C),i.on("drain",_).on("error",w)}return!0}Fe.exports=rt});var ft=J(ct());var xe=class{constructor(){this.headers={};this.statusCode=null}_addBody(e){let r=this.headers["content-length"];this.body=Buffer.concat(e,r?Number(r):void 0)}_parseHeaders(e){for(let r=1;r<e.length;r+=2){let s=e[r-1].toLowerCase(),n=this.headers[s];n?(Array.isArray(n)||(n=[n],this.headers[s]=n),n.push(e[r])):this.headers[s]=e[r]}}json(e="utf8"){return JSON.parse(this.body.toString(e))}text(e="utf8"){return this.body.toString(e)}};var pt=J(require("url")),mt=J(require("path")),gt=J(require("querystring")),_e=class{constructor(e,r="GET"){this.coreOptions={};this.httpMethod="GET";this.reqHeaders={};this.timeoutOptions={};if(this.url=typeof e=="string"?new pt.URL(e):e,this.httpMethod=r,!["http:","https:"].includes(this.url.protocol))throw new Error(`Bad URL protocol: ${this.url.protocol}`)}client(e,r){return this.kClient=e,r&&(this.keepClient=!0),this}query(e,r){if(typeof e=="object")for(let s of Object.keys(e))this.url.searchParams.append(s,e[s]);else this.url.searchParams.append(e,r);return this}path(e){return this.url.pathname=(0,mt.join)(this.url.pathname,e),this}body(e,r){switch(r){case"json":{this.data=JSON.stringify(e),this.header({"content-type":"application/json","content-length":Buffer.byteLength(this.data).toString()});break}case"form":{this.data=(0,gt.stringify)(e),this.header({"content-type":"application/x-www-form-urlencoded","content-length":Buffer.byteLength(this.data).toString()});break}case"stream":{this.data=e;break}default:{typeof e=="object"&&!Buffer.isBuffer(e)?(this.data=JSON.stringify(e),this.header({"content-type":"application/json","content-length":Buffer.byteLength(this.data).toString()})):(this.data=e,this.header("content-length",Buffer.byteLength(this.data).toString()));break}}return this}header(e,r){if(typeof e=="object")for(let s of Object.keys(e))this.reqHeaders[s.toLowerCase()]=e[s];else this.reqHeaders[e.toLowerCase()]=r;return this}method(e){return this.httpMethod=e,this}timeout(e,r){return typeof e=="string"?this.timeoutOptions[e]=r:this.timeoutOptions.bodyTimeout=e,this}option(e,r){return typeof e=="object"?Object.assign(this.coreOptions,e):this.coreOptions[e]=r,this}async json(){return(await this.send()).json()}async raw(){return(await this.send()).body}async text(){return(await this.send()).text()}send(){return new Promise((e,r)=>{var d;let s={path:this.url.pathname+this.url.search,method:this.httpMethod,headers:this.reqHeaders,body:this.data},n=(d=this.kClient)!=null?d:new ft.default(this.url.origin,this.coreOptions),h=new xe,o=[];n.dispatch(s,{onData:l=>o.push(l),onError:l=>r(l),onComplete:()=>{this.keepClient||n.close(),h._addBody(o),e(h)},onConnect:()=>null,onHeaders:(l,u,i)=>{h.statusCode=l,h._parseHeaders(u),i()}})})}};module.exports=function(e,r="GET"){return new _e(e,r)};
